import{a5 as de,a1 as I,I as ve,ap as pe,aq as H,ar as X,au as te,U as G,av as Y,y as B,a as C,B as me,s as ue,K as fe,l as F,T as he,aG as ge,m as ee,aH as ye,k as ce,L as xe,N as be,aI as Ce,d as Pe,aa as $e,A as ne,a8 as Ae,a9 as we,e as qe,w as N,n as h,u as a,a6 as Se,a7 as ke,S as b,o as Te,h as x,f as S,ah as ae,P as $,ad as A,ac as Q}from"./index.4f28c451.js";import{g as se,s as oe,c as Ve}from"./selection.431e8dda.js";import{Q as Ee}from"./QPage.2432808d.js";import{G as w}from"./GetSuffix.07bc2bf5.js";import{E as ie,_ as J}from"./EncodeText.66f9b238.js";import{useQoriPayRepository as le}from"./axios.0a217806.js";import"./QInput.406e0e67.js";import"./format.801e7424.js";function De(t){const s=[.06,6,50];return typeof t=="string"&&t.length&&t.split(":").forEach((c,g)=>{const v=parseFloat(c);v&&(s[g]=v)}),s}var Ne=de({name:"touch-swipe",beforeMount(t,{value:s,arg:c,modifiers:g}){if(g.mouse!==!0&&I.has.touch!==!0)return;const v=g.mouseCapture===!0?"Capture":"",e={handler:s,sensitivity:De(c),direction:se(g),noop:ve,mouseStart(l){oe(l,e)&&pe(l)&&(H(e,"temp",[[document,"mousemove","move",`notPassive${v}`],[document,"mouseup","end","notPassiveCapture"]]),e.start(l,!0))},touchStart(l){if(oe(l,e)){const d=l.target;H(e,"temp",[[d,"touchmove","move","notPassiveCapture"],[d,"touchcancel","end","notPassiveCapture"],[d,"touchend","end","notPassiveCapture"]]),e.start(l)}},start(l,d){I.is.firefox===!0&&X(t,!0);const P=te(l);e.event={x:P.left,y:P.top,time:Date.now(),mouse:d===!0,dir:!1}},move(l){if(e.event===void 0)return;if(e.event.dir!==!1){G(l);return}const d=Date.now()-e.event.time;if(d===0)return;const P=te(l),p=P.left-e.event.x,u=Math.abs(p),m=P.top-e.event.y,r=Math.abs(m);if(e.event.mouse!==!0){if(u<e.sensitivity[1]&&r<e.sensitivity[1]){e.end(l);return}}else if(u<e.sensitivity[2]&&r<e.sensitivity[2])return;const y=u/d,k=r/d;e.direction.vertical===!0&&u<r&&u<100&&k>e.sensitivity[0]&&(e.event.dir=m<0?"up":"down"),e.direction.horizontal===!0&&u>r&&r<100&&y>e.sensitivity[0]&&(e.event.dir=p<0?"left":"right"),e.direction.up===!0&&u<r&&m<0&&u<100&&k>e.sensitivity[0]&&(e.event.dir="up"),e.direction.down===!0&&u<r&&m>0&&u<100&&k>e.sensitivity[0]&&(e.event.dir="down"),e.direction.left===!0&&u>r&&p<0&&r<100&&y>e.sensitivity[0]&&(e.event.dir="left"),e.direction.right===!0&&u>r&&p>0&&r<100&&y>e.sensitivity[0]&&(e.event.dir="right"),e.event.dir!==!1?(G(l),e.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Ve(),e.styleCleanup=E=>{e.styleCleanup=void 0,document.body.classList.remove("non-selectable");const T=()=>{document.body.classList.remove("no-pointer-events--children")};E===!0?setTimeout(T,50):T()}),e.handler({evt:l,touch:e.event.mouse!==!0,mouse:e.event.mouse,direction:e.event.dir,duration:d,distance:{x:u,y:r}})):e.end(l)},end(l){e.event!==void 0&&(Y(e,"temp"),I.is.firefox===!0&&X(t,!1),e.styleCleanup!==void 0&&e.styleCleanup(!0),l!==void 0&&e.event.dir!==!1&&G(l),e.event=void 0)}};t.__qtouchswipe=e,g.mouse===!0&&H(e,"main",[[t,"mousedown","mouseStart",`passive${v}`]]),I.has.touch===!0&&H(e,"main",[[t,"touchstart","touchStart",`passive${g.capture===!0?"Capture":""}`],[t,"touchmove","noop","notPassiveCapture"]])},updated(t,s){const c=t.__qtouchswipe;c!==void 0&&(s.oldValue!==s.value&&(typeof s.value!="function"&&c.end(),c.handler=s.value),c.direction=se(s.modifiers))},beforeUnmount(t){const s=t.__qtouchswipe;s!==void 0&&(Y(s,"main"),Y(s,"temp"),I.is.firefox===!0&&X(t,!1),s.styleCleanup!==void 0&&s.styleCleanup(),delete t.__qtouchswipe)}});function Be(){const t=new Map;return{getCache:function(s,c){return t[s]===void 0?t[s]=c:t[s]},getCacheWithFn:function(s,c){return t[s]===void 0?t[s]=c():t[s]}}}const Fe={name:{required:!0},disable:Boolean},re={setup(t,{slots:s}){return()=>F("div",{class:"q-panel scroll",role:"tabpanel"},ee(s.default))}},je={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},Me=["update:modelValue","before-transition","transition"];function Oe(){const{props:t,emit:s,proxy:c}=ue(),{getCacheWithFn:g}=Be();let v,e;const l=B(null),d=B(null);function P(o){const n=t.vertical===!0?"up":"left";V((c.$q.lang.rtl===!0?-1:1)*(o.direction===n?1:-1))}const p=C(()=>[[Ne,P,void 0,{horizontal:t.vertical!==!0,vertical:t.vertical,mouse:!0}]]),u=C(()=>t.transitionPrev||`slide-${t.vertical===!0?"down":"right"}`),m=C(()=>t.transitionNext||`slide-${t.vertical===!0?"up":"left"}`),r=C(()=>`--q-transition-duration: ${t.transitionDuration}ms`),y=C(()=>typeof t.modelValue=="string"||typeof t.modelValue=="number"?t.modelValue:String(t.modelValue)),k=C(()=>({include:t.keepAliveInclude,exclude:t.keepAliveExclude,max:t.keepAliveMax})),E=C(()=>t.keepAliveInclude!==void 0||t.keepAliveExclude!==void 0);me(()=>t.modelValue,(o,n)=>{const i=D(o)===!0?q(o):-1;e!==!0&&O(i===-1?0:i<q(n)?-1:1),l.value!==i&&(l.value=i,s("before-transition",o,n),fe(()=>{s("transition",o,n)}))});function T(){V(1)}function j(){V(-1)}Object.assign(c,{next:T,previous:j,goTo:M});function M(o){s("update:modelValue",o)}function D(o){return o!=null&&o!==""}function q(o){return v.findIndex(n=>n.props.name===o&&n.props.disable!==""&&n.props.disable!==!0)}function _(){return v.filter(o=>o.props.disable!==""&&o.props.disable!==!0)}function O(o){const n=o!==0&&t.animated===!0&&l.value!==-1?"q-transition--"+(o===-1?u.value:m.value):null;d.value!==n&&(d.value=n)}function V(o,n=l.value){let i=n+o;for(;i>-1&&i<v.length;){const f=v[i];if(f!==void 0&&f.props.disable!==""&&f.props.disable!==!0){O(o),e=!0,s("update:modelValue",f.props.name),setTimeout(()=>{e=!1});return}i+=o}t.infinite===!0&&v.length>0&&n!==-1&&n!==v.length&&V(o,o===-1?v.length:-1)}function R(){const o=q(t.modelValue);return l.value!==o&&(l.value=o),!0}function U(){const o=D(t.modelValue)===!0&&R()&&v[l.value];return t.keepAlive===!0?[F(ye,k.value,[F(E.value===!0?g(y.value,()=>({...re,name:y.value})):re,{key:y.value,style:r.value},()=>o)])]:[F("div",{class:"q-panel scroll",style:r.value,key:y.value,role:"tabpanel"},[o])]}function L(){if(v.length!==0)return t.animated===!0?[F(he,{name:d.value},U)]:U()}function K(o){return v=ge(ee(o.default,[])).filter(n=>n.props!==null&&n.props.slot===void 0&&D(n.props.name)===!0),v.length}function z(){return v}return{panelIndex:l,panelDirectives:p,updatePanelsList:K,updatePanelIndex:R,getPanelContent:L,getEnabledPanels:_,getPanels:z,isValidPanelName:D,keepAliveProps:k,needsUniqueKeepAliveWrapper:E,goToPanelByOffset:V,goToPanel:M,nextPanel:T,previousPanel:j}}var Z=ce({name:"QTabPanel",props:Fe,setup(t,{slots:s}){return()=>F("div",{class:"q-tab-panel"},ee(s.default))}}),Re=ce({name:"QTabPanels",props:{...je,...xe},emits:Me,setup(t,{slots:s}){const c=ue(),g=be(t,c.proxy.$q),{updatePanelsList:v,getPanelContent:e,panelDirectives:l}=Oe(),d=C(()=>"q-tab-panels q-panel-parent"+(g.value===!0?" q-tab-panels--dark q-dark":""));return()=>(v(s),Ce("div",{class:d.value},e(),"pan",t.swipeable,()=>l.value))}});const We=Pe({__name:"TwoFactorAuthentication",setup(t){var O,V,R,U,L,K,z,o;const s=Se(),c=ke();B(!1);const{t:g,locale:v}=$e({useScope:"global"}),e=ne({mailCode:null,mailHash:null}),l=ne({smsCode:null,smsHash:null}),d=B(!1),P=B(null),p=B("email"),u=Ae(),{loginForm:m}=we(u),r=C(()=>b.lt.md),y=C(()=>u.Active2FA),k=C(()=>b.lt.sm),E=C(()=>p.value==="email"?u.Email:`+${u.Phone}`),T=n=>{e.mailCode=n},j=async(n,i)=>{const{data:f}=await le.sendCode({Modulo:n,User:m.value.mode==="email"?m.value.emailOrPhone:`${m.value.code}${m.value.emailOrPhone}`.replaceAll("+",""),Password:m.value.password});if(f.error){s.notify({position:r.value?"bottom":"top-right",message:`Ups... ${g(f.errorKey)}`,color:"red",icon:"warning"});return}else i(f)},M=n=>{l.smsCode=n},D=n=>{P.value=n},q=n=>{(n==="phone"&&y.value.telefono||n==="email"&&y.value.correo||n==="authy"&&y.value.authy)&&(p.value=n,c.replace({path:"/two-factor-auth",query:{type:p.value}}))},_=async()=>{d.value=!0;const n={};p.value==="email"&&Object.assign(n,e),p.value==="phone"&&Object.assign(n,l),p.value==="authy"&&Object.assign(n,{"2FAToken":P.value});const{data:i}=await le.login({Modulo:"validarCliente",User:m.value.mode==="email"?m.value.emailOrPhone:`${m.value.code}${m.value.emailOrPhone}`.replaceAll("+",""),Password:m.value.password,...n});if(d.value=!1,Boolean(i.error)){s.notify({position:r.value?"bottom":"top-right",message:`Ups... ${g(i==null?void 0:i.errorKey)}`,color:"red",icon:"warning"});return}else u.setToken(i.token),u.setUserName(i.username),u.setPreAuth(!1),u.clearLoginForm(),u.clearSignUpForm(),await c.push("/")};if(c.currentRoute.value.query){const n=Object.keys(y.value).filter(i=>y.value[i]);if(n){const i=n.toString()==="correo"?"email":n.toString()==="telefono"?"phone":"authy";q((U=(R=(V=(O=c.currentRoute.value)==null?void 0:O.query)==null?void 0:V.type)==null?void 0:R.toString())!=null?U:i)}else q((o=(z=(K=(L=c.currentRoute.value)==null?void 0:L.query)==null?void 0:K.type)==null?void 0:z.toString())!=null?o:"email")}return(n,i)=>(Te(),qe(Ee,{class:h(["hp-100",{"bg-nv-dark":a($).isActive,"bg-nv-light":!a($).isActive,"flex column flex-center":!a(r)}])},{default:N(()=>[x("div",{class:h({"wp-30":a(b).lg,"wp-40":a(b).lt.lg&&!a(r)})},[x("div",{class:h({"flex justify-end q-pt-lg q-px-md":a(r),"wp-100 flex justify-end":!a(r)})},[S(ae,{flat:"",rounded:"",size:"md",onClick:i[0]||(i[0]=f=>a(c).push("/login")),icon:"cancel",class:"q-px-none"})],2),x("div",{class:h([{"flex wp-100 justify-center":a(b).sm},"q-px-md q-pt-lg"])},[x("h5",{class:h([{"fs-23":a(k),"text-white":a($).isActive,"text-left":!a(r)||a(b).gt.sm||a(b).xs,"wp-60":a(b).sm},"no-padding q-mb-xs q-mt-sm"])},A(n.$t("codeValidation.twoFAValidation")),3),x("div",{class:h([{"wp-60":a(b).sm,"justify-start":a(b).gt.sm||a(b).xs},"flex flex-inline mt-35"])},[x("div",{class:h([`
                            ${p.value==="email"?`bg-nv-${a(w)("secondary")}
                            ${a($).isActive?"text-white":"text-nv-light-accent"}`:`text-nv-${a(w)(`${a($).isActive?"secondary":"tertiary"}`)}`}
                        `,"flex items-center justify-center py-10 px-17 br-30 fs-12 ls-2 q-mr-sm cursor-pointer"]),onClick:i[1]||(i[1]=f=>q("email"))},A(n.$t("fields.email")),3),x("div",{class:h([`
                            ${p.value==="phone"?`bg-nv-${a(w)("secondary")}
                            ${a($).isActive?"text-white":"text-nv-light-accent"}`:`text-nv-${a(w)(`${a($).isActive?"secondary":"tertiary"}`)}`}
                        `,"flex items-center justify-center px-17 py-10 br-30 fs-12 ls-2 cursor-pointer q-mx-xs"]),onClick:i[2]||(i[2]=f=>q("phone"))},A(n.$t("fields.phoneNumber")),3),x("div",{class:h([`
                            ${p.value==="authy"?`bg-nv-${a(w)("secondary")}
                            ${a($).isActive?"text-white":"text-nv-light-accent"}`:`text-nv-${a(w)(`${a($).isActive?"secondary":"tertiary"}`)}`}
                        `,"flex items-center justify-center px-17 py-10 br-30 fs-12 ls-2 cursor-pointer"]),onClick:i[3]||(i[3]=f=>q("authy"))}," Authy ",2)],2),S(Re,{class:h(`bg-nv-${a($).isActive?"dark":"light"} text-nv-light-tertiary ${a(b).sm?"wp-60":"wp-100"}`),modelValue:p.value,"onUpdate:modelValue":i[6]||(i[6]=f=>p.value=f),animated:""},{default:N(()=>[S(Z,{class:"no-margin no-padding no-scroll",name:"email"},{default:N(()=>[x("p",{class:h([{"fs-14":a(r),"fs-16":!a(r)},"mt-30 mb-40"])},[Q(A(n.$t("codeValidation.sendTo"))+" ",1),x("span",{class:h(`text-nv-${a(w)("accent")} q-mx-xs`)},A(a(ie)(a(E),p.value)),3)],2),S(J,{code:e.mailCode,disable:d.value,mode:"counter2FAEmail",class:"wp-100",onAddCode:T,onRemoveCode:T,onSendCode:i[4]||(i[4]=f=>j("EnviarMail",W=>e.mailHash=W.hash))},null,8,["code","disable"])]),_:1}),S(Z,{class:"no-margin no-padding no-scroll",name:"phone"},{default:N(()=>[x("p",{class:h([{"fs-14":a(r),"fs-16":!a(r)},"mt-30 mb-40"])},[Q(A(n.$t("codeValidation.sendTo"))+" ",1),x("span",{class:h(`text-nv-${a(w)("accent")} q-mx-xs`)},A(a(ie)(a(E),p.value)),3)],2),S(J,{class:"wp-100",disable:d.value,code:l.smsCode,mode:"counter2FAPhone",onAddCode:M,onRemoveCode:M,onSendCode:i[5]||(i[5]=f=>j("EnviarSms",W=>l.smsHash=W.hash))},null,8,["disable","code"])]),_:1}),S(Z,{class:"no-margin no-padding no-scroll",name:"authy"},{default:N(()=>[x("p",{class:h([{"fs-14":a(r),"fs-16":!a(r)},"mt-30 mb-40"])},[Q(A(n.$t("codeValidation.enter"))+" ",1),x("span",{class:h(`text-nv-${a(w)("accent")} q-mx-xs`)}," Authy ",2),Q(" "+A(n.$t("codeValidation.toObtain")),1)],2),S(J,{disable:d.value,class:"wp-100",code:P.value,"show-send-code":!1,onAddCode:D,onRemoveCode:D},null,8,["disable","code"])]),_:1})]),_:1},8,["class","modelValue"]),S(ae,{color:`nv-${a(w)("primary")}`,class:"full-width br-20 py-12 mt-40 fs-16",unelevated:"","no-caps":"",onClick:_,loading:d.value},{default:N(()=>[Q(A(n.$t("buttons.continue")),1)]),_:1},8,["color","loading"])],2)],2)]),_:1},8,["class"]))}});export{We as default};
